---
phase: 07-export-import-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/models/deck.py, src/routes/main.py, src/templates/decks.html]
autonomous: true
---

<objective>
Implement deck export and import functionality via JSON files.

Purpose: Allow users to share decks with classmates or backup their flashcard collections.
Output: Export button on decks page, import form, and JSON file handling.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/models/deck.py
@src/models/flashcard.py
@src/routes/main.py
@src/templates/decks.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add deck export functionality</name>
  <files>src/models/deck.py, src/routes/main.py, src/templates/decks.html</files>
  <action>
1. Add `Deck.export_to_dict(deck_id)` method in deck.py:
   - Returns dict with: name, created_at (ISO format string), cards (list of {question, answer})
   - Excludes internal IDs and study statistics (just the content for sharing)
   - Returns None if deck not found

2. Add `GET /deck/<int:deck_id>/export` route in main.py:
   - Call Deck.export_to_dict(deck_id)
   - If not found, redirect to /decks with flash error
   - Return JSON response with Content-Disposition header for file download
   - Filename: `{deck_name}_flashcards.json`
   - Use Flask's jsonify with Response for proper headers

3. Add Export button to decks.html:
   - Add "Export" link/button next to Delete button
   - Style with Tailwind: blue outline button (border-blue-600, text-blue-600)
   - Links to /deck/{id}/export
  </action>
  <verify>Visit /decks, click Export on a deck, verify JSON file downloads with correct structure</verify>
  <done>Export button downloads JSON file with deck name, creation date, and card Q&A pairs</done>
</task>

<task type="auto">
  <name>Task 2: Add deck import functionality with validation</name>
  <files>src/models/deck.py, src/routes/main.py, src/templates/decks.html</files>
  <action>
1. Add `Deck.import_from_dict(data)` method in deck.py:
   - Validate required fields: 'name' (string), 'cards' (list)
   - Each card must have 'question' and 'answer' strings
   - Raise ValueError with descriptive message if validation fails
   - Create deck with Deck.create(name)
   - Create flashcards with Flashcard.create(deck_id, question, answer) for each card
   - Return created deck dict

2. Add `POST /import` route in main.py:
   - Accept file upload (request.files['deck_file'])
   - Read and parse JSON (handle JSONDecodeError)
   - Call Deck.import_from_dict(data)
   - Catch ValueError for validation errors, JSONDecodeError for parse errors
   - Flash success message with deck name and card count
   - Flash error message with specific issue if import fails
   - Redirect to /decks

3. Add Import section to decks.html:
   - Add form at top of page (before deck grid) with file input
   - Style: subtle gray background section, file input + "Import Deck" button
   - Form: method="POST" action="/import" enctype="multipart/form-data"
   - Accept only .json files: accept=".json"
  </action>
  <verify>Export a deck, then import it - verify new deck appears with all cards</verify>
  <done>Import form accepts JSON file, validates structure, creates deck with cards, shows success/error messages</done>
</task>

<task type="auto">
  <name>Task 3: Add flash message display to base template</name>
  <files>src/templates/base.html</files>
  <action>
Add flash message display in base.html (if not already present):
1. After the nav section, before {% block content %}
2. Check for flashed messages: {% with messages = get_flashed_messages(with_categories=true) %}
3. Display each message with category-based styling:
   - success: green background (bg-green-100 text-green-800)
   - error: red background (bg-red-100 text-red-800)
   - info: blue background (bg-blue-100 text-blue-800)
4. Messages should auto-dismiss or have close button
5. Center-align, max-w-4xl container for consistency
  </action>
  <verify>Import an invalid JSON file, verify error message displays. Import valid file, verify success message displays.</verify>
  <done>Flash messages display with appropriate colors for success/error/info categories</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Export button appears on each deck card
- [ ] Clicking Export downloads .json file with correct structure
- [ ] Import form appears on decks page
- [ ] Importing valid JSON creates new deck with all cards
- [ ] Importing invalid JSON shows helpful error message
- [ ] Flash messages display with correct styling
- [ ] Flask app runs without errors
</verification>

<success_criteria>

- All tasks completed
- Export downloads well-structured JSON
- Import validates and creates decks correctly
- Error messages are helpful and specific
- No errors or warnings introduced
</success_criteria>

<output>
After completion, create `.planning/phases/07-export-import-polish/07-01-SUMMARY.md`
</output>
