{% extends "base.html" %}

{% block title %}Session Complete - {{ deck.name }} - AI Flashcard Generator{% endblock %}

{% block content %}
<!-- Study session summary - shows performance and cards needing practice -->
<!-- For students: This page displays after completing a deck -->
<!-- With spaced repetition, all cards are mastered by the end (session only ends when all "Got it!") -->
<!-- Stats show: cards mastered, total attempts, and which cards needed extra practice -->
<div class="max-w-4xl mx-auto">
    <!-- Congratulations header -->
    <div class="text-center mb-8">
        <h2 class="text-3xl font-bold text-gray-800 mb-2">All cards mastered! Great work!</h2>
        <p class="text-xl text-gray-600">{{ deck.name }}</p>
    </div>

    <!-- Statistics display in grid -->
    <!-- For students: md:grid-cols-2 means 2 columns on desktop, single column on mobile -->
    <!-- With spaced repetition, we show attempts vs cards to show how many re-queues happened -->
    <div class="grid md:grid-cols-2 gap-6 mb-8">
        <!-- Cards mastered stat -->
        <div class="bg-white rounded-lg shadow border-l-4 border-green-500 p-6">
            <div class="text-gray-600 text-sm font-semibold uppercase mb-1">Cards Mastered</div>
            <div class="text-4xl font-bold text-green-600">{{ total_cards }}</div>
            <div class="text-sm text-gray-500 mt-1">All cards completed!</div>
        </div>

        <!-- Total attempts stat -->
        <!-- For students: This shows how many times cards were shown overall -->
        <!-- If > card count, it means some cards were re-queued -->
        <div class="bg-white rounded-lg shadow border-l-4 border-blue-500 p-6">
            <div class="text-gray-600 text-sm font-semibold uppercase mb-1">Total Attempts</div>
            <div class="text-4xl font-bold text-gray-800">{{ total_attempts }}</div>
            {% if total_attempts > total_cards %}
            <div class="text-sm text-gray-500 mt-1">{{ total_attempts - total_cards }} re-queue{{ 's' if (total_attempts - total_cards) != 1 else '' }}</div>
            {% else %}
            <div class="text-sm text-gray-500 mt-1">No re-queues needed!</div>
            {% endif %}
        </div>

        <!-- First-try success rate -->
        <!-- For students: This shows what percentage of attempts were "Got it!" -->
        <div class="bg-white rounded-lg shadow border-l-4 border-purple-500 p-6">
            <div class="text-gray-600 text-sm font-semibold uppercase mb-1">Success Rate</div>
            <div class="text-4xl font-bold text-gray-800">{{ success_rate }}%</div>
            <div class="text-sm text-gray-500 mt-1">{{ success_count }} "Got it!" / {{ total_attempts }} attempts</div>
        </div>

        <!-- Cards needing extra practice -->
        <div class="bg-white rounded-lg shadow border-l-4 border-yellow-500 p-6">
            <div class="text-gray-600 text-sm font-semibold uppercase mb-1">Needed Extra Practice</div>
            <div class="text-4xl font-bold text-yellow-600">{{ cards_needing_extra|length }}</div>
            <div class="text-sm text-gray-500 mt-1">{{ 'card' if cards_needing_extra|length == 1 else 'cards' }} re-queued</div>
        </div>
    </div>

    <!-- Cards that needed extra practice (conditional) -->
    <!-- For students: This section shows cards that were re-queued during the session -->
    <!-- These are cards you initially marked "Needs Practice" but eventually mastered -->
    {% if cards_needing_extra|length > 0 %}
    <div class="bg-white rounded-lg shadow p-6 mb-8">
        <h3 class="text-xl font-bold text-gray-800 mb-4">Cards that needed extra practice:</h3>
        <p class="text-gray-600 mb-4">These cards were re-queued before you mastered them. Consider reviewing them again soon!</p>
        <ul class="space-y-2">
            {% for card in cards_needing_extra %}
            <!-- For students: Shows which cards needed multiple attempts -->
            <li class="text-gray-700 border-l-4 border-yellow-500 pl-4 py-2 flex justify-between items-center">
                <span>{{ card.question }}</span>
                <span class="text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded">{{ card.attempts }} attempts</span>
            </li>
            {% endfor %}
        </ul>
    </div>
    {% else %}
    <!-- Perfect score celebration -->
    <!-- For students: This celebratory message appears when you get everything right on first try -->
    <div class="bg-gradient-to-r from-green-400 to-green-600 rounded-lg shadow-xl p-8 mb-8 text-center">
        <p class="text-3xl font-bold text-white mb-2">Perfect! All cards mastered on first try!</p>
        <p class="text-white text-lg">No cards needed re-queuing - excellent recall!</p>
    </div>
    {% endif %}

    <!-- Action buttons -->
    <!-- For students: Two options after completing the session -->
    <div class="flex flex-col sm:flex-row gap-4">
        <!-- Study Again button - restart this deck -->
        <a href="/study/{{ deck.id }}"
           class="flex-1 bg-green-600 text-white py-4 px-6 rounded-md hover:bg-green-700 transition-colors font-bold text-lg text-center">
            Study Again
        </a>

        <!-- Back to My Decks button - return to deck selection -->
        <a href="/decks"
           class="flex-1 bg-gray-600 text-white py-4 px-6 rounded-md hover:bg-gray-700 transition-colors font-bold text-lg text-center">
            Back to My Decks
        </a>
    </div>
</div>
{% endblock %}
